<?xml version="1.0"?>

<?include "cpack_variables.wxi"?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
    <Product Id="$(var.CPACK_WIX_PRODUCT_GUID)"
        Name="$(var.CPACK_PACKAGE_NAME)"
        Language="1033"
        Version="$(var.CPACK_PACKAGE_VERSION)"
        Manufacturer="$(var.CPACK_PACKAGE_VENDOR)"
        UpgradeCode="$(var.CPACK_WIX_UPGRADE_GUID)">

        <Package InstallerVersion="301" InstallPrivileges="elevated"
                 Compressed="yes" InstallScope="perMachine" />

        <Media Id="1" Cabinet="Project.cab" EmbedCab="yes" CompressionLevel="high" />

        <MajorUpgrade
            Schedule="afterInstallInitialize"
            AllowSameVersionUpgrades="yes"
            DowngradeErrorMessage="A newer version of [ProductName] is already installed. Setup will now exit."/>

        <Property Id="FOUNDNSISINSTALLER">
            <RegistrySearch Id="FOUNDNSISINSTALLER_REGSEARCH"
                Root="HKLM"
                Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(var.CPACK_PACKAGE_NAME)"
                Name="UninstallString"
                Type="raw"
                Win64="no" />
        </Property>
        <Condition Message="An old version of $(var.CPACK_PACKAGE_NAME) has been detected. Please uninstall it manually before running this installer.">
            <![CDATA[NOT FOUNDNSISINSTALLER]]>
        </Condition>

        <WixVariable Id="WixUILicenseRtf" Value="$(var.CPACK_WIX_LICENSE_RTF)"/>
        <Property Id="WIXUI_INSTALLDIR" Value="INSTALL_ROOT"/>

        <?ifdef CPACK_WIX_PRODUCT_ICON?>
        <Property Id="ARPPRODUCTICON">ProductIcon.ico</Property>
        <Icon Id="ProductIcon.ico" SourceFile="$(var.CPACK_WIX_PRODUCT_ICON)"/>
        <?endif?>

        <?ifdef CPACK_WIX_UI_BANNER?>
        <WixVariable Id="WixUIBannerBmp" Value="$(var.CPACK_WIX_UI_BANNER)"/>
        <?endif?>

        <?ifdef CPACK_WIX_UI_DIALOG?>
        <WixVariable Id="WixUIDialogBmp" Value="$(var.CPACK_WIX_UI_DIALOG)"/>
        <?endif?>

        <FeatureRef Id="ProductFeature"/>

        <UIRef Id="$(var.CPACK_WIX_UI_REF)" />

        <?include "properties.wxi"?>
        <?include "product_fragment.wxi"?>
    </Product>
</Wix>
